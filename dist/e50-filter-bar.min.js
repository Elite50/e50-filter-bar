/*! e50-filter-bar 2015-02-24 */
angular.module("e50Filter.tpls",["views/components/e50-filter-bar.tpl.html"]),angular.module("views/components/e50-filter-bar.tpl.html",[]).run(["$templateCache",function(a){a.put("views/components/e50-filter-bar.tpl.html",'<div>\n  <div ng-if="bar.options.count">{{bar.getCount() || bar.data.length}} {{options.listLabel || \'Results\'}}</div>\n  \n  <div ng-if="bar.options.filters">\n    <select ng-model="bar.filter.key" ng-change="bar.filter.onchange()" ng-options="item[0] as item[1] for item in bar.filter.options" ng-if="bar.filter.hasOptions()"></select>\n  </div>\n\n  <div ng-if="bar.options.views">\n    <a href="" ng-repeat="view in bar.views.options" ng-click="bar.views.setView(view)">{{view}}</a>\n  </div>\n\n  <div ng-if="bar.options.sort">\n    <select ng-model="bar.sort.key" ng-change="bar.sort.onchange()" ng-options="item[0] as item[1] for item in bar.sort.options" ng-if="bar.sort.hasOptions()">\n    </select>\n    <a href="" ng-click="bar.sort.reverse()">flip</a>\n  </div>\n  \n  <div ng-if="bar.options.search">\n    <a href="" ng-click="bar.search.toggle()">toggle search</a>\n    <input type="text" placeholder="Filter search" ng-if="bar.search.isOpen()" ng-model="bar.search.text">\n  </div>\n\n  <div ng-if="bar.options.actions">\n    <select ng-model="bar.actions.key" ng-change="bar.actions.onchange()" ng-options="item[0] as item[1] for item in bar.actions.options" ng-if="bar.actions.hasOptions()"></select>\n  </div>\n</div>')}]),angular.module("e50FilterBar",["e50Filter.tpls"]),angular.module("e50FilterBar").directive("e50FilterBar",function(){return{restrict:"EA",replace:!0,priority:1,transclude:!0,terminal:!0,scope:{bar:"=filter"},templateUrl:"views/components/e50-filter-bar.tpl.html"}}),angular.module("e50FilterBar").factory("E50Count",function(){function a(){this.value=0,this.label="Results"}return{"new":function(b){return new a(b)}}}),angular.module("e50FilterBar").factory("E50Dropdown",["E50Toggle",function(a){function b(b){angular.extend(this,a),this.options=[],this.key="id",this.getKey=function(){return this.key},this.setKey=function(a){this.key=a},this.setOptions=function(a){this.options=a},this.hasOptions=function(){return this.options.length},this.onChange=function(a){this.onchange=a},this.onchange=function(a){this.setKey(a),this.close()},angular.extend(this,b)}return{"new":function(a){return new b(a)}}}]),angular.module("e50FilterBar").factory("E50Filter",["E50Dropdown","E50Count","E50Views","E50Search",function(a,b,c,d){function e(e,f){this.options={count:!0,filters:!0,views:!0,sort:!0,search:!0,actions:!0,commaSeparated:!0},angular.extend(this.options,e),this.count=b.new(),this.filter=a.new({key:"all"}),this.views=c.new(),this.sort=a.new({key:"name",asc:!1,ascLabel:"ASC",reverse:function(){this.asc=!this.asc,this.ascLabel=this.asc?"DSC":"ASC"}}),this.actions=a.new(),this.search=d.new({text:"",placeholder:"Search",_closeOnDocumentClick:!1}),this.fetch=function(){this.fetchParams={sort:this.sort.key,filter:this.filter.key,q:this.search.text}}.bind(this),this.sortKey=function(){return this.sort.key.value||this.sort.key},this.filterKey=function(){return this.filter.key.value},this.asc=function(){return this.sort.asc},this.searchText=function(){return this.search.resultsFor},this.commaSeparated=function(a){return this.options.commaSeparated?x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):a},this.data={},angular.extend(this,f)}return{"new":function(a){return new e(a)}}}]),angular.module("e50FilterBar").factory("E50Search",["E50Toggle",function(a){function b(b){angular.extend(this,a),this.text="",this.resultsFor="",this.placeholder="Search",this.setPlaceholder=function(a){this.placeholder=a},this.submit=function(){this.submitted=!0,this.resultsFor=angular.copy(this.text)}.bind(this),this.clear=function(){this.submitted=!1,this.text="",this.resultsFor=""}.bind(this),angular.extend(this,b)}return{"new":function(a){return new b(a)}}}]),angular.module("e50FilterBar").factory("E50Toggle",["$rootScope","$timeout",function(a,b){return{_open:!1,_closeOnDocumentClick:!0,isOpen:function(){return this._open},isClosed:function(){return!this._open},open:function(){if(this._open=!0,this._closeOnDocumentClick){var c=this;b(function(){$(document).bind("click.e50-toggle",function(){this.close(),a.$apply(),$(document).unbind("click.e50-toggle")}.bind(c))})}},close:function(){this._open=!1},toggle:function(){var a=this._open?"close":"open";this[a]()}}}]),angular.module("e50FilterBar").factory("E50Views",function(){function a(a){this.view="table",this.options=[],this.setViews=function(a){this.options=a},this.setView=function(a){this.view=a.toLowerCase()},this.isView=function(a){return this.view===a},this.getView=function(){return this.view},this.setDefault=this.setView,angular.extend(this,a)}return{"new":function(b){return new a(b)}}});